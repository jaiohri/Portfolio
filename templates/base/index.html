{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ title|default:"Personal Website" }}{% endblock %}</title>
    <link rel="icon" href="{% url 'pages:favicon' %}" type="image/x-icon">
    
    <!-- Tailwind CSS (compiled) -->
    <link rel="stylesheet" href="{% static 'css/site.css' %}">
    
    <!-- Alpine.js -->

    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Ephesis&display=swap" rel="stylesheet">
    
    {% block extra_css %}{% endblock %}
</head>
<body class="min-h-screen font-sans text-white bg-gradient-to-br from-black via-gray-900 to-black">
    <div id="loader-overlay" class="fixed left-0 right-0 bottom-0 top-16 z-40 hidden items-center justify-center bg-black">
        <div class="loader"></div>
    </div>
    
    <!-- Scrollable Content Wrapper -->
    <div class="h-screen overflow-y-scroll scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent">
        <!-- Header -->
        <header class="bg-white/10 backdrop-blur-md fixed w-full top-0 z-50 border-b border-white/20" x-data="{ mobileMenuOpen: false }">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="{% url 'pages:home' %}" class="flex items-center hover:opacity-80 transition-opacity duration-300">
                    <img src="{% static 'images/jai_logo.png' %}" alt="Logo" class="h-14 w-14 sm:h-16 sm:w-16 object-contain">
                </a>
                
                <!-- Desktop Navigation -->
                <ul class="hidden md:flex space-x-8 items-center">
                    <li><a href="{% url 'pages:home' %}" class="text-white hover:text-yellow-300 transition-colors duration-300">Home</a></li>
                    <li><a href="{% url 'pages:about' %}" class="text-white hover:text-yellow-300 transition-colors duration-300">About</a></li>
                    <li><a href="{% url 'pages:portfolio' %}" class="text-white hover:text-yellow-300 transition-colors duration-300">Portfolio</a></li>
                    {% if user.is_authenticated and user.username != 'guest' and user.is_staff %}
                    <li><a href="{% url 'pages:experiences' %}" class="text-white hover:text-yellow-300 transition-colors duration-300">Edit Experiences</a></li>
                    {% endif %}
                    <li><a href="{% url 'pages:contact' %}" class="text-white hover:text-yellow-300 transition-colors duration-300">Contact</a></li>
                    {% if user.is_authenticated %}
                        {% if user.username != 'guest' and user.is_staff %}
                        <li><a href="{% url 'pages:logout' %}" class="text-gray-400 hover:text-yellow-300 transition-colors duration-300 text-sm">Logout ({{ user.username }})</a></li>
                        {% else %}
                        <li><a href="{% url 'pages:login' %}" class="text-gray-400 hover:text-yellow-300 transition-colors duration-300 text-sm">Admin Login</a></li>
                        {% endif %}
                    {% else %}
                    <li><a href="{% url 'pages:login' %}" class="text-gray-400 hover:text-yellow-300 transition-colors duration-300 text-sm">Admin Login</a></li>
                    {% endif %}
                </ul>
                
                <!-- Mobile Menu Button -->
                <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden text-white focus:outline-none focus:ring-2 focus:ring-yellow-300 rounded p-2" aria-label="Toggle menu">
                    <svg x-show="!mobileMenuOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                    <svg x-show="mobileMenuOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="display: none;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Mobile Navigation -->
            <div x-show="mobileMenuOpen" 
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 transform -translate-y-2"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 transform translate-y-0"
                 x-transition:leave-end="opacity-0 transform -translate-y-2"
                 class="md:hidden pb-4 border-t border-white/20 mt-2 pt-4"
                 style="display: none;">
                <ul class="flex flex-col space-y-4">
                    <li><a href="{% url 'pages:home' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300 py-2" @click="mobileMenuOpen = false">Home</a></li>
                    <li><a href="{% url 'pages:about' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300 py-2" @click="mobileMenuOpen = false">About</a></li>
                    <li><a href="{% url 'pages:portfolio' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300 py-2" @click="mobileMenuOpen = false">Portfolio</a></li>
                    {% if user.is_authenticated and user.username != 'guest' and user.is_staff %}
                    <li><a href="{% url 'pages:experiences' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300 py-2" @click="mobileMenuOpen = false">Edit Experiences</a></li>
                    {% endif %}
                    <li><a href="{% url 'pages:contact' %}" class="block text-white hover:text-yellow-300 transition-colors duration-300 py-2" @click="mobileMenuOpen = false">Contact</a></li>
                    {% if user.is_authenticated %}
                        {% if user.username != 'guest' and user.is_staff %}
                        <li><a href="{% url 'pages:logout' %}" class="block text-gray-400 hover:text-yellow-300 transition-colors duration-300 text-sm py-2" @click="mobileMenuOpen = false">Logout ({{ user.username }})</a></li>
                        {% else %}
                        <li><a href="{% url 'pages:login' %}" class="block text-gray-400 hover:text-yellow-300 transition-colors duration-300 text-sm py-2" @click="mobileMenuOpen = false">Admin Login</a></li>
                        {% endif %}
                    {% else %}
                    <li><a href="{% url 'pages:login' %}" class="block text-gray-400 hover:text-yellow-300 transition-colors duration-300 text-sm py-2" @click="mobileMenuOpen = false">Admin Login</a></li>
                    {% endif %}
                </ul>
            </div>
        </nav>
    </header>

        <!-- Main Content -->
        <main class="pt-16">
            {% block content %}{% endblock %}
        </main>

        <!-- Footer -->
        <footer class="bg-black/30 text-white text-center py-8 mt-16">
            <div class="max-w-7xl mx-auto px-4">
                <p>&copy; 2024 {{ name|default:"Your Name" }}. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <!-- Cursor Trail Effect -->
    <script src="{% static 'js/cursor-trail.js' %}"></script>
    
    <!-- Custom JavaScript -->
    <script>
        (function(){
            var overlay = document.getElementById('loader-overlay');
            if(!overlay) return;

            function show(ms){
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
                if (ms) {
                    setTimeout(hide, ms);
                }
            }
            function hide(){
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }

            // Initial load behavior: show only on first visit for 2s
            if (!sessionStorage.getItem('visited')) {
                show();
                setTimeout(function(){
                    hide();
                    sessionStorage.setItem('visited', '1');
                }, 2000);
            } else {
                // Ensure hidden on subsequent loads
                hide();
            }

            // Link clicks to different views: show for 1s
            document.addEventListener('click', function(e){
                var a = e.target.closest('a');
                if(!a) return;
                var href = a.getAttribute('href');
                if(!href) return;
                if (href.startsWith('#')) return; // ignore in-page anchors
                if (a.target === '_blank') return; // ignore new tab
                if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return; // respect modifier opens
                e.preventDefault();
                show();
                setTimeout(function(){ window.location.href = href; }, 1000);
            });
        })();
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>
